const MyRouter=function(t){const e=t=>{const e={};for(const[r,n]of t)(e[r]??=[]).push(n);return e},r=t=>{if("true"===t)return!0;if("false"===t)return!1;if("null"===t)return null;if("undefined"===t)return;const e=Number(t);return Number.isNaN(e)||""===t.trim()?t:e},n=t=>{const e={};for(const[n,o]of Object.entries(t))e[n]=o.map(r);return e},o=()=>{const r=t.location.hash.replace(/^#!\/?/,"").split("?"),o=r[0]||"",a=r[1]||"",s=new URLSearchParams(t.location.search.slice(1)),c=new URLSearchParams(a);return{path:o,query:e(s),params:e(c),queryTyped:n(e(s)),paramsTyped:n(e(c))}};let a=o(),s={...a},c=[],i=[],l=[],u=[],h=!1,f=t.location.hash;const p=(t,e="info")=>{l.forEach((r=>{try{r(t,e,{route:a,prevRoute:s})}catch(t){}}))},y=t=>{u.forEach((e=>{try{e(t)}catch(t){}}))};let m=new Map;const d=e=>{const r={winX:t.pageXOffset,winY:t.pageYOffset,timestamp:Date.now(),route:e};y({type:"capture",...r}),m.set(e,r)},g=e=>{const r=m.get(e);r&&requestAnimationFrame((()=>{t.scrollTo(r.winX,r.winY),y({type:"restore",...r})}))},w=async t=>{if(h)return!1;a.path&&d(a.path);const e=c.map((async e=>{if("function"==typeof e)return await e(t,a)}));try{return await Promise.all(e),!0}catch(t){return p(`❌ ${t.message}`,"error"),!1}},v=t=>{h||(s={...a},a=t,i.forEach((e=>{if("function"==typeof e)try{e(t,s)}catch(t){}})),g(t.path),p("✅ Navigation complete","success"))},E=async()=>{if(h)return;if((t=>{const e=t.slice(1);return!t.startsWith("#!/")&&document?.getElementById?.(e)})(t.location.hash))return void requestAnimationFrame((()=>{const e=document?.getElementById?.(t.location.hash.slice(1));e?.scrollIntoView?.({behavior:"smooth"})}));if(t.location.hash===f)return;p("🔄 Navigating...","loading");const e=o();if(await w(e))f=t.location.hash,v(e);else{const e=s.path?"#!/"+s.path:"";t.location.hash=e,f=e}},O=async(e,r=!1)=>{const n=e.replace(/^\/+/,""),a=e.startsWith("#")?e:"#!/"+n;p("🔄 Navigating...","loading");const s={...o(),path:n};if(!await w(s))return!1;if(r){const e=t.location.href.replace(/#.*$/,"");t.location.replace(e+a)}else t.location.hash=a;return f=a,v(s),!0};t.addEventListener("hashchange",E);const b=()=>{if(h)return;const e={type:"update",winX:t.pageXOffset,winY:t.pageYOffset,timestamp:Date.now(),route:a.path};y(e)};return t.addEventListener("scroll",b),E(),{beforeEach:t=>"function"!=typeof t||h?()=>{}:(c.push(t),t(a,s),()=>{if(h)return;const e=c.indexOf(t);-1!==e&&c.splice(e,1)}),afterEach:t=>"function"!=typeof t||h?()=>{}:(i.push(t),()=>{if(h)return;const e=i.indexOf(t);-1!==e&&i.splice(e,1)}),onStatus:t=>"function"!=typeof t||h?()=>{}:(l.push(t),()=>{if(h)return;const e=l.indexOf(t);-1!==e&&l.splice(e,1)}),onScroll:t=>"function"!=typeof t||h?()=>{}:(u.push(t),()=>{if(h)return;const e=u.indexOf(t);-1!==e&&u.splice(e,1)}),push:t=>O(t,!1),replace:t=>O(t,!0),currentRoute:()=>({...a}),previousRoute:()=>({...s}),getRouteState:()=>({to:{...a},from:{...s}}),getTypedParams:()=>a.paramsTyped,getTypedQuery:()=>a.queryTyped,saveScrollPosition:(t=a.path)=>d(t),restoreScrollPosition:(t=a.path)=>g(t),clearScrollHistory:()=>m.clear(),go:e=>t.history.go(e),back:()=>t.history.back(),forward:()=>t.history.forward(),destroy:()=>{h=!0,f="",t.removeEventListener("hashchange",E),t.removeEventListener("scroll",b),c.length=0,i.length=0,l.length=0,u.length=0,m.clear()}}}(globalThis);